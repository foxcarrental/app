<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fox Car Rental - Dashboard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Supabase CDN (only needed for main auth check, not for individual pages loaded in iframe) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Using a subtle gradient from the image colors for the body background */
            background: linear-gradient(135deg, #5680E9, #84CEEB, #5AB9EA, #C1C8E4, #8860D0);
            background-size: 400% 400%;
            animation: gradientAnimation 15s ease infinite;
            background-attachment: fixed; /* Ensures gradient covers full viewport */
            display: flex; /* Make body a flex container for sidebar and content */
            height: 100vh; /* Full viewport height */
            overflow: hidden; /* Prevent body scroll, iframe will handle its own scroll */
        }

        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* New keyframes for the light blue gradient animation */
        @keyframes lightBlueGradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Custom styles for the main layout */
        .sidebar-scroll {
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #a8a8a8 #f1f1f1;
        }
        .sidebar-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .sidebar-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .sidebar-scroll::-webkit-scrollbar-thumb {
            background-color: #a8a8a8;
            border-radius: 6px;
        }

        /* New styles for fixed header and sidebar */
        /* The main header is now part of the content area, but kept styles for reference if needed elsewhere */
        #main-header {
            position: absolute; /* Changed to absolute, as it's within main-content which is now an iframe */
            top: 0;
            left: 0;
            right: 0;
            z-index: 40;
            background-color: transparent;
            box-shadow: none;
            padding: 1rem; /* Added padding to ensure space */
        }

        #desktop-sidebar {
            position: fixed; /* Sidebar remains fixed */
            top: 0;
            left: 0;
            height: 100vh;
            z-index: 50;
            transition: width 0.3s ease-in-out;
            /* Apply the light blue gradient and animation */
            background: linear-gradient(135deg, #E0F2F7, #E8F6FC, #E0F2F7); /* Light blue gradient */
            background-size: 300% 300%;
            animation: lightBlueGradientAnimation 8s ease infinite;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* Keep a subtle shadow */
        }

        #desktop-sidebar .sidebar-title,
        #desktop-sidebar .nav-text,
        #desktop-sidebar #logout-text,
        #desktop-sidebar .nav-item i {
            color: #333; /* Ensure text and icons are dark for readability on light background */
        }

        #desktop-sidebar .nav-item.active {
            background-color: rgba(136, 96, 208, 0.1); /* Light purple for active state */
            color: #8860D0; /* Darker purple text for active state */
        }

        #main-content-iframe-container {
            flex-grow: 1; /* Takes up remaining space */
            padding: 1rem; /* Padding around the iframe */
            margin-left: 16rem; /* Initial margin for content when sidebar is expanded by default */
            transition: margin-left 0.3s ease-in-out;
            display: flex;
            flex-direction: column; /* To stack header and iframe */
        }

        /* Adjust main content margin when sidebar collapses */
        body.sidebar-collapsed #main-content-iframe-container {
            margin-left: 5rem; /* Corresponds to collapsed sidebar width */
        }

        iframe {
            flex-grow: 1; /* Iframe takes up remaining height in its container */
            border: none;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            /* Applied the gradient background to the iframe itself */
            background: linear-gradient(135deg, #5680E9, #84CEEB, #5AB9EA, #C1C8E4, #8860D0);
            background-size: 400% 400%;
            animation: gradientAnimation 15s ease infinite;
            background-color: transparent; /* Ensure transparent to show gradient */
        }

        /* Collapsed state for the sidebar */
        #desktop-sidebar.collapsed {
            width: 5rem; /* Width when collapsed */
        }

        #desktop-sidebar.collapsed .nav-text,
        #desktop-sidebar.collapsed .sidebar-title,
        #desktop-sidebar.collapsed #logout-text {
             display: none;
        }

        #desktop-sidebar.collapsed .sidebar-logo {
            justify-content: center;
        }

        #desktop-sidebar.collapsed .sidebar-pin-controls {
            justify-content: center;
        }

        #desktop-sidebar .nav-item i {
            width: 2rem; /* Ensure icons align */
            text-align: center;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
                height: auto;
                overflow-y: auto; /* Allow scrolling on smaller screens */
            }
            #desktop-sidebar {
                position: static; /* No longer fixed */
                width: 100%;
                height: auto;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                border-radius: 0 0 1rem 1rem;
                padding-bottom: 0.5rem;
                box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            }
            #desktop-sidebar .sidebar-logo,
            #desktop-sidebar .sidebar-pin-controls {
                display: none; /* Hide these controls on mobile */
            }
            #desktop-sidebar .nav-item {
                flex-grow: 1;
                text-align: center;
                justify-content: center;
            }
            #desktop-sidebar.collapsed {
                width: 100%; /* Ensure it spans full width on mobile */
            }
            #desktop-sidebar.collapsed .nav-text,
            #desktop-sidebar.collapsed .sidebar-title,
            #desktop-sidebar.collapsed #logout-text {
                display: block; /* Show text on mobile even if conceptual 'collapsed' */
            }
            #desktop-sidebar.collapsed .nav-item i {
                margin-right: 0.5rem; /* Adjust icon spacing */
            }
            #main-content-iframe-container {
                margin-left: 0; /* No left margin on mobile */
                padding-top: 0; /* No extra padding for header on mobile */
                height: auto;
            }
        }
    </style>
</head>
<body class="sidebar-expanded"> <!-- Default to expanded, can change if needed -->

    <!-- Sidebar for Desktop -->
    <aside id="desktop-sidebar" class="flex flex-col w-64 shadow-lg p-4 sidebar-scroll">
        <div class="flex items-center p-4 mb-6 border-b sidebar-logo">
            <img src="https://yzwfldypkwqndxjchgit.supabase.co/storage/v1/object/public/public-logo//logo.JPG" alt="Fox Car Rental Logo" class="w-10 h-10 rounded-full mr-3 shrink-0">
            <h1 class="text-xl font-bold sidebar-title">Fox Car Rental</h1>
        </div>
        <nav class="flex-grow">
            <ul>
                <!-- Navigation items - data-src for iframe -->
                <li class="mb-2">
                    <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-all duration-200 nav-item" data-src="dashboard-content.html" data-tab-id="dashboard">
                        <i class="fas fa-tachometer-alt mr-3"></i> <span class="nav-text">Dashboard</span>
                    </a>
                </li>
                <li class="mb-2">
                    <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-all duration-200 nav-item" data-src="vehicle-inventory.html" data-tab-id="vehicle-inventory">
                        <i class="fas fa-car mr-3"></i> <span class="nav-text">Vehicle Inventory</span>
                    </a>
                </li>
                <li class="mb-2">
                    <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-all duration-200 nav-item" data-src="vehicle-registration.html" data-tab-id="vehicle-registration">
                        <i class="fas fa-id-card mr-3"></i> <span class="nav-text">Vehicle Registration</span>
                    </a>
                </li>
                <li class="mb-2">
                    <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-all duration-200 nav-item" data-src="customer-list.html" data-tab-id="customer-list">
                        <i class="fas fa-users mr-3"></i> <span class="nav-text">Customer List</span>
                    </a>
                </li>
                <li class="mb-2">
                    <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-all duration-200 nav-item" data-src="rent-history.html" data-tab-id="rent-history">
                        <i class="fas fa-history mr-3"></i> <span class="nav-text">Rent History</span>
                    </a>
                </li>
                <li class="mb-2">
                    <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-all duration-200 nav-item" data-src="reports.html" data-tab-id="reports">
                        <i class="fas fa-chart-bar mr-3"></i> <span class="nav-text">Reports</span>
                    </a>
                </li>
                 <li class="mb-2">
                    <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-all duration-200 nav-item" data-src="vehicle-maintenance.html" data-tab-id="vehicle-maintenance">
                        <i class="fas fa-wrench mr-3"></i> <span class="nav-text">Under Maintenance</span>
                    </a>
                </li>
                <li class="mb-2">
                    <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-all duration-200 nav-item" data-src="financial-dashboard.html" data-tab-id="financial">
                        <i class="fas fa-dollar-sign mr-3"></i> <span class="nav-text">Financial</span>
                    </a>
                </li>
                <li class="mb-2">
                    <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-all duration-200 nav-item" data-src="business-analytics.html" data-tab-id="analytics">
                        <i class="fas fa-chart-pie mr-3"></i> <span class="nav-text">Analytics</span>
                    </a>
                </li>
                <li class="mb-2">
                    <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-all duration-200 nav-item" data-src="coming_soon.html" data-tab-id="settings">
                        <i class="fas fa-cogs mr-3"></i> <span class="nav-text">Settings</span>
                    </a>
                </li>
                <li class="mb-2">
                    <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-all duration-200 nav-item" data-src="coming_soon.html" data-tab-id="support">
                        <i class="fas fa-headset mr-3"></i> <span class="nav-text">Support</span>
                    </a>
                </li>
                <li class="mb-2">
                    <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-all duration-200 nav-item" data-src="coming_soon.html" data-tab-id="documents">
                        <i class="fas fa-file-alt mr-3"></i> <span class="nav-text">Documents</span>
                    </a>
                </li>
                 <li class="mb-2">
                    <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-all duration-200 nav-item" data-src="coming_soon.html" data-tab-id="notifications">
                        <i class="fas fa-bell mr-3"></i> <span class="nav-text">Notifications</span>
                    </a>
                </li>
                <li class="mb-2">
                    <a href="#" class="flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-all duration-200 nav-item" data-src="coming_soon.html" data-tab-id="user-management">
                        <i class="fas fa-users-cog mr-3"></i> <span class="nav-text">User Management</span>
                    </a>
                </li>
            </ul>
        </nav>
        <div class="pt-4 border-t">
             <div class="flex items-center justify-end text-gray-500 mb-2 sidebar-pin-controls">
                <button id="pin-sidebar-btn" title="Pin sidebar" class="p-2 rounded-full hover:bg-gray-200 hidden">
                    <i class="fas fa-chevron-right"></i>
                </button>
                <button id="unpin-sidebar-btn" title="Unpin sidebar" class="p-2 rounded-full hover:bg-gray-200">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
             <a href="#" id="logout-button-desktop" class="flex items-center p-3 rounded-lg text-red-500 hover:bg-red-100 transition-all duration-200 nav-item">
                <i class="fas fa-sign-out-alt mr-3"></i> <span id="logout-text">Logout</span>
            </a>
        </div>
    </aside>

    <!-- Main Content Area (Iframe Container) -->
    <div id="main-content-iframe-container" class="flex flex-col flex-1 p-4">
        <!-- The iframe will load content here -->
        <iframe id="mainContentIframe" src="dashboard-content.html"></iframe>
    </div>

    <!-- Modal for notifications (Main layout level, so it covers everything) -->
    <div id="notification-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md text-center">
            <h3 id="notification-title" class="text-xl font-bold mb-4">Notification</h3>
            <p id="notification-message" class="text-gray-700 mb-6"></p>
            <button id="notification-close-button" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50">Close</button>
        </div>
    </div>

    <script type="module">
        // --- Supabase Configuration for Authentication ---
        const SUPABASE_URL = 'https://yzwfldypkwqndxjchgit.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl6d2ZsZHlwa3dxbmR4amNoZ2l0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkzMjA0OTUsImV4cCI6MjA2NDg5NjQ5NX0.i3HOii7L9mJ-cBZ2us3TRmS0-GI9bylHuLe9INAu4zY';

        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

        // --- DOM Elements for Main Layout ---
        const ui = {
            desktopSidebar: document.getElementById('desktop-sidebar'),
            mainContentIframe: document.getElementById('mainContentIframe'),
            logoutButtonDesktop: document.getElementById('logout-button-desktop'),
            pinBtn: document.getElementById('pin-sidebar-btn'),
            unpinBtn: document.getElementById('unpin-sidebar-btn'),
            notificationModal: document.getElementById('notification-modal'),
            notificationTitle: document.getElementById('notification-title'),
            notificationMessage: document.getElementById('notification-message'),
            notificationCloseButton: document.getElementById('notification-close-button'),
            sidebarNavLinks: document.querySelectorAll('#desktop-sidebar .nav-item')
        };

        // --- Sidebar State ---
        let isSidebarPinned = true; // Default to expanded/pinned state
        document.body.classList.add('sidebar-expanded');
        ui.pinBtn.classList.add('hidden'); // Hide pin button as it's pinned by default
        ui.unpinBtn.classList.remove('hidden'); // Show unpin button

        // --- Modal Logic ---
        function showMessage(message, title = "Notification") {
            ui.notificationTitle.textContent = title;
            ui.notificationMessage.textContent = message;
            ui.notificationModal.classList.remove('hidden');
        }

        function hideMessage() {
            ui.notificationModal.classList.add('hidden');
        }

        ui.notificationCloseButton.addEventListener('click', hideMessage);

        // --- Sidebar Pin/Unpin Logic ---
        function setupDesktopSidebar() {
            // Initial state based on isSidebarPinned
            if (isSidebarPinned) {
                document.body.classList.add('sidebar-expanded');
                document.body.classList.remove('sidebar-collapsed');
                ui.desktopSidebar.classList.remove('collapsed');
                ui.pinBtn.classList.add('hidden');
                ui.unpinBtn.classList.remove('hidden');
            } else {
                document.body.classList.remove('sidebar-expanded');
                document.body.classList.add('sidebar-collapsed');
                ui.desktopSidebar.classList.add('collapsed');
                ui.pinBtn.classList.remove('hidden');
                ui.unpinBtn.classList.add('hidden');
            }

            ui.desktopSidebar.addEventListener('mouseenter', () => {
                if (!isSidebarPinned) {
                    document.body.classList.remove('sidebar-collapsed'); // Expand
                    document.body.classList.add('sidebar-expanded');
                    ui.desktopSidebar.classList.remove('collapsed');
                }
            });

            ui.desktopSidebar.addEventListener('mouseleave', () => {
                if (!isSidebarPinned) {
                    document.body.classList.add('sidebar-collapsed'); // Collapse
                    document.body.classList.remove('sidebar-expanded');
                    ui.desktopSidebar.classList.add('collapsed');
                }
            });

            ui.pinBtn.addEventListener('click', () => {
                isSidebarPinned = true;
                localStorage.setItem('sidebarPinned', 'true');
                applySidebarState();
            });

            ui.unpinBtn.addEventListener('click', () => {
                isSidebarPinned = false;
                localStorage.setItem('sidebarPinned', 'false');
                applySidebarState();
            });
        }

        // --- Iframe Navigation Logic ---
        function navigateIframe(url, tabId) {
            ui.mainContentIframe.src = url;

            // Update active state in sidebar
            ui.sidebarNavLinks.forEach(link => {
                link.classList.remove('bg-purple-100', 'text-purple-700', 'font-bold');
                link.classList.add('text-gray-700', 'hover:bg-gray-100');
            });

            const activeLink = document.querySelector(`[data-tab-id="${tabId}"]`);
            if (activeLink) {
                activeLink.classList.add('bg-purple-100', 'text-purple-700', 'font-bold');
                activeLink.classList.remove('text-gray-700', 'hover:bg-gray-100');
            }
        }

        function generatePlaceholderContent(tabName) {
            return `
                <body style='font-family: &apos;Inter&apos;, sans-serif; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #f8fafc; color: #334155; text-align: center; padding: 20px;'>
                    <h1 style='font-size: 2.5rem; color: #1e3a8a;'>${tabName} - Coming Soon!</h1>
                    <p style='font-size: 1.1rem; line-height: 1.6;'>This section is under development. Please check back later for exciting updates.</p>
                    <div style='margin-top: 20px; padding: 15px 30px; background-color: #dbeafe; border-radius: 10px; border: 1px solid #93c5fd; color: #1e40af; font-weight: bold;'>
                        Back to Dashboard
                    </div>
                </body>
            `;
        }


        // Add click listeners to sidebar navigation links
        ui.sidebarNavLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault(); // Prevent default link behavior
                const targetSrc = link.dataset.src;
                const tabId = link.dataset.tabId;

                if (targetSrc) {
                    navigateIframe(targetSrc, tabId);
                } else {
                    // For placeholder pages, use srcdoc directly
                    ui.mainContentIframe.srcdoc = generatePlaceholderContent(link.querySelector('.nav-text').textContent.trim());
                    navigateIframe('', tabId); // Update active state, src is handled by srcdoc
                }
            });
        });

        // --- Authentication Check (on main layout load) ---
        async function checkAuthentication() {
            try {
                const { data: { session }, error } = await supabaseClient.auth.getSession();
                if (error) {
                    console.error("Error getting session:", error);
                    // Handle error, maybe show a message
                    return;
                }
                if (!session) {
                    window.location.href = 'login.html'; // Redirect to login if no session
                } else {
                    // User is authenticated, proceed
                    // The initial iframe load is already set to dashboard-content.html
                }
            } catch (error) {
                console.error("Unexpected error during authentication check:", error);
            }
        }

        // --- Logout Logic ---
        ui.logoutButtonDesktop.addEventListener('click', async (e) => {
            e.preventDefault();
            showMessage("You have been logged out (simulated).", "Logged Out");
            // Clear the iframe content or redirect if desired
            ui.mainContentIframe.srcdoc = generatePlaceholderContent('Logged Out');
            // Simulate clearing active state
            ui.sidebarNavLinks.forEach(link => {
                link.classList.remove('bg-purple-100', 'text-purple-700', 'font-bold');
                link.classList.add('text-gray-700', 'hover:bg-gray-100');
            });
            // You might want to truly sign out from Supabase here:
            // await supabaseClient.auth.signOut();
            // window.location.href = 'login.html';
        });

        window.addEventListener('DOMContentLoaded', () => {
            setupDesktopSidebar();
            checkAuthentication();
            // Ensure Dashboard is active on initial load
            const dashboardLink = document.querySelector('[data-tab-id="dashboard"]');
            if (dashboardLink) {
                 // Set the initial active state for the Dashboard link
                 dashboardLink.classList.add('bg-purple-100', 'text-purple-700', 'font-bold');
                 dashboardLink.classList.remove('text-gray-700', 'hover:bg-gray-100');
                 ui.mainContentIframe.src = dashboardLink.dataset.src; // Ensure iframe loads dashboard
            }
        });
    </script>
</body>
</html>
